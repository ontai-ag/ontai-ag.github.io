import{c as A,r as n,t as me,g as ue,j as e,v as Ze,h as Q,l as _,P as I,k as P,A as pe,n as W,w as Je,x as et,D as tt,C as st,y as at,e as X,b as he,m as rt,a as ot,f as nt,d as it}from"./index-CtopovmE.js";import{u as ct,f as lt,F as G,a as q,b as L,c as Y,d as dt,e as U,t as mt,o as ut,h as pt,s as ae}from"./form-D7x3u0mp.js";import{H as re,F as oe}from"./Footer-BgDtOJl9.js";import{B as b}from"./button-BRSmxxCB.js";import{T as ne}from"./textarea-DYpTejAM.js";import{C as K,a as B,b as V,c as ie,d as H}from"./card-DzZ0TOHa.js";import{u as ht,h as xt,R as ft,a as yt,F as vt}from"./index-B1C6HH2G.js";import{S as ce}from"./separator-NAsj1iUX.js";import{C as z}from"./circle-check-CgW0RYsk.js";import{C as xe}from"./circle-alert-C6OOmd-R.js";import{c as fe,R as gt,I as jt}from"./index-CesaXqAL.js";import{u as Nt}from"./index-Cfv6qraW.js";import{u as bt}from"./index-BktiXWNb.js";import{C as Pt}from"./circle-t8JHmHto.js";import{L as F}from"./label-Dfi70rOt.js";import{M as wt}from"./mail-gsKxIjph.js";import{M as Ct}from"./message-square-cxi37AI5.js";import{S as Rt,B as St,C as kt,t as le}from"./taskService-DBx92114.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=A("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=A("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=A("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=A("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=A("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=A("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var D="Popover",[ye,Ss]=Q(D,[me]),T=me(),[Mt,w]=ye(D),ve=t=>{const{__scopePopover:r,children:s,open:c,defaultOpen:a,onOpenChange:o,modal:i=!1}=t,l=T(r),m=n.useRef(null),[p,x]=n.useState(!1),[f,h]=ue({prop:c,defaultProp:a??!1,onChange:o,caller:D});return e.jsx(Ze,{...l,children:e.jsx(Mt,{scope:r,contentId:ht(),triggerRef:m,open:f,onOpenChange:h,onOpenToggle:n.useCallback(()=>h(u=>!u),[h]),hasCustomAnchor:p,onCustomAnchorAdd:n.useCallback(()=>x(!0),[]),onCustomAnchorRemove:n.useCallback(()=>x(!1),[]),modal:i,children:s})})};ve.displayName=D;var ge="PopoverAnchor",Ot=n.forwardRef((t,r)=>{const{__scopePopover:s,...c}=t,a=w(ge,s),o=T(s),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=a;return n.useEffect(()=>(i(),()=>l()),[i,l]),e.jsx(pe,{...o,...c,ref:r})});Ot.displayName=ge;var je="PopoverTrigger",Ne=n.forwardRef((t,r)=>{const{__scopePopover:s,...c}=t,a=w(je,s),o=T(s),i=_(r,a.triggerRef),l=e.jsx(I.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Re(a.open),...c,ref:i,onClick:P(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:e.jsx(pe,{asChild:!0,...o,children:l})});Ne.displayName=je;var Z="PopoverPortal",[Ft,Dt]=ye(Z,{forceMount:void 0}),be=t=>{const{__scopePopover:r,forceMount:s,children:c,container:a}=t,o=w(Z,r);return e.jsx(Ft,{scope:r,forceMount:s,children:e.jsx(W,{present:s||o.open,children:e.jsx(Je,{asChild:!0,container:a,children:c})})})};be.displayName=Z;var k="PopoverContent",Pe=n.forwardRef((t,r)=>{const s=Dt(k,t.__scopePopover),{forceMount:c=s.forceMount,...a}=t,o=w(k,t.__scopePopover);return e.jsx(W,{present:c||o.open,children:o.modal?e.jsx(Gt,{...a,ref:r}):e.jsx(qt,{...a,ref:r})})});Pe.displayName=k;var $t=et("PopoverContent.RemoveScroll"),Gt=n.forwardRef((t,r)=>{const s=w(k,t.__scopePopover),c=n.useRef(null),a=_(r,c),o=n.useRef(!1);return n.useEffect(()=>{const i=c.current;if(i)return xt(i)},[]),e.jsx(ft,{as:$t,allowPinchZoom:!0,children:e.jsx(we,{...t,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:P(t.onCloseAutoFocus,i=>{var l;i.preventDefault(),o.current||(l=s.triggerRef.current)==null||l.focus()}),onPointerDownOutside:P(t.onPointerDownOutside,i=>{const l=i.detail.originalEvent,m=l.button===0&&l.ctrlKey===!0,p=l.button===2||m;o.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:P(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),qt=n.forwardRef((t,r)=>{const s=w(k,t.__scopePopover),c=n.useRef(!1),a=n.useRef(!1);return e.jsx(we,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,l;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(c.current||(l=s.triggerRef.current)==null||l.focus(),o.preventDefault()),c.current=!1,a.current=!1},onInteractOutside:o=>{var m,p;(m=t.onInteractOutside)==null||m.call(t,o),o.defaultPrevented||(c.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;((p=s.triggerRef.current)==null?void 0:p.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),we=n.forwardRef((t,r)=>{const{__scopePopover:s,trapFocus:c,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:m,onFocusOutside:p,onInteractOutside:x,...f}=t,h=w(k,s),u=T(s);return yt(),e.jsx(vt,{asChild:!0,loop:!0,trapped:c,onMountAutoFocus:a,onUnmountAutoFocus:o,children:e.jsx(tt,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:x,onEscapeKeyDown:l,onPointerDownOutside:m,onFocusOutside:p,onDismiss:()=>h.onOpenChange(!1),children:e.jsx(st,{"data-state":Re(h.open),role:"dialog",id:h.contentId,...u,...f,ref:r,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ce="PopoverClose",Lt=n.forwardRef((t,r)=>{const{__scopePopover:s,...c}=t,a=w(Ce,s);return e.jsx(I.button,{type:"button",...c,ref:r,onClick:P(t.onClick,()=>a.onOpenChange(!1))})});Lt.displayName=Ce;var Yt="PopoverArrow",Ut=n.forwardRef((t,r)=>{const{__scopePopover:s,...c}=t,a=T(s);return e.jsx(at,{...a,...c,ref:r})});Ut.displayName=Yt;function Re(t){return t?"open":"closed"}var Kt=ve,Bt=Ne,Vt=be,Se=Pe;const Ht=Kt,zt=Bt,ke=n.forwardRef(({className:t,align:r="center",sideOffset:s=4,...c},a)=>e.jsx(Vt,{children:e.jsx(Se,{ref:a,align:r,sideOffset:s,className:X("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...c})}));ke.displayName=Se.displayName;const Qt={from:t=>({update:r=>({eq:(s,c)=>Promise.resolve({error:new Error(`Supabase removed, called update on ${t}`)})})})},S={generatePaymentId:()=>`KZ-${Math.floor(1e8+Math.random()*9e8)}`,recordPayment:async t=>{try{return console.log(`[PAYMENT_ATTEMPT] ${new Date().toISOString()} - Recording payment:`,{paymentId:t.paymentId,amount:t.amount,status:t.status,taskId:t.taskId||"N/A",userId:t.userId||"N/A"}),t.userId&&console.log(`[PAYMENT_LOG] ${new Date().toISOString()} - Payment recorded:`,{payment_id:t.paymentId,amount:t.amount,status:t.status,task_id:t.taskId,user_id:t.userId,transaction_time:new Date().toISOString()}),console.log(`[PAYMENT_SUCCESS] ${new Date().toISOString()} - Payment recorded successfully:`,t.paymentId),!0}catch(r){return console.error(`[PAYMENT_ERROR] ${new Date().toISOString()} - Error recording payment:`,r),!1}},verifyPayment:async t=>{try{console.log(`[PAYMENT_VERIFY] ${new Date().toISOString()} - Verifying payment:`,t);const r=Math.random();let s;return r<.8?s="completed":r<.9?s="pending":s="failed",console.log(`[PAYMENT_VERIFY_RESULT] ${new Date().toISOString()} - Payment ${t} verification result:`,s),s}catch(r){return console.error(`[PAYMENT_ERROR] ${new Date().toISOString()} - Error verifying payment:`,r),"failed"}},updateTaskPaymentStatus:async(t,r)=>{try{console.log(`[TASK_PAYMENT_UPDATE] ${new Date().toISOString()} - Updating task payment status:`,{taskId:t,status:r});const{error:s}=await Qt.from("tasks").update({payment_status:r}).eq("id",t);if(s)throw console.error(`[TASK_PAYMENT_ERROR] ${new Date().toISOString()} - Failed to update task payment status:`,s),s;return console.log(`[TASK_PAYMENT_SUCCESS] ${new Date().toISOString()} - Task payment status updated successfully:`,{taskId:t,status:r}),!0}catch(s){return console.error(`[TASK_PAYMENT_ERROR] ${new Date().toISOString()} - Error updating task payment status:`,s),!1}},getPaymentAnalytics:async(t,r)=>{try{console.log(`[ANALYTICS_REQUEST] ${new Date().toISOString()} - Fetching payment analytics`);const s={totalTransactions:125,successRate:92.5,averageAmount:35.75,timeDistribution:{9:12,10:15,11:20,12:18,13:22,14:19,15:14,16:5}};return console.log(`[ANALYTICS_SUCCESS] ${new Date().toISOString()} - Analytics calculated:`,s),s}catch(s){return console.error(`[ANALYTICS_ERROR] ${new Date().toISOString()} - Error calculating payment analytics:`,s),null}}},Wt=({amount:t,onSuccess:r,onFailed:s})=>{const{toast:c}=he(),[a,o]=n.useState("initial"),[i,l]=n.useState(S.generatePaymentId()),[m,p]=n.useState(!1),[x,f]=n.useState(!1),h="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data="+encodeURIComponent(`kaspi://pay?service=AIPlatform&amount=${t}&account=${i}`);n.useEffect(()=>{(async()=>{await S.recordPayment({paymentId:i,amount:t,status:"pending"})})()},[i,t]);const u=()=>{navigator.clipboard.writeText(i),p(!0),c({description:"Payment ID copied to clipboard"}),setTimeout(()=>p(!1),2e3)},v=async()=>{if(!x){f(!0),o("verifying");try{const g=await S.verifyPayment(i);g==="completed"?(o("confirm"),setTimeout(()=>{r()},1500)):g==="pending"?(o("qr"),c({title:"Payment still pending",description:"The payment has not been completed yet. Please complete the payment in your Kaspi app.",variant:"destructive"})):(o("failed"),c({title:"Payment failed",description:"Your payment could not be processed. Please try again.",variant:"destructive"}),s&&s())}catch(g){console.error("Error verifying payment:",g),o("failed"),c({title:"Verification error",description:"Could not verify payment status. Please try again.",variant:"destructive"})}finally{f(!1)}}},j=()=>{l(S.generatePaymentId()),o("initial")};return e.jsxs("div",{className:"space-y-6",children:[a==="initial"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsx("h3",{className:"font-medium text-sm",children:"Kaspi Payment"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Amount"}),e.jsxs("span",{className:"font-medium",children:["$",t.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Payment Method"}),e.jsx("span",{className:"font-medium",children:"Kaspi Bank"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Payment ID"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-xs mr-2 font-mono",children:i}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-900",children:m?e.jsx(z,{className:"h-3.5 w-3.5 text-green-500"}):e.jsx(de,{className:"h-3.5 w-3.5"})})]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(b,{onClick:()=>o("qr"),className:"w-full",children:["Pay with Kaspi QR",e.jsx(Et,{className:"ml-2 h-4 w-4"})]}),!1]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"By proceeding with the payment, you agree to our Terms of Service and Payment Processing Policy."})]}),a==="qr"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Scan with Kaspi App"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Open your Kaspi App and scan this QR code"}),e.jsx("div",{className:"border p-4 rounded-lg mb-4",children:e.jsx("img",{src:h,alt:"Kaspi QR Payment",className:"w-48 h-48"})}),e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"Payment ID"}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("code",{className:"bg-gray-100 px-3 py-1 rounded text-sm font-mono mr-2",children:i}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-900",children:m?e.jsx(z,{className:"h-4 w-4 text-green-500"}):e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(b,{variant:"outline",onClick:()=>o("initial"),className:"w-full",children:"Back to Payment Options"}),e.jsx(b,{onClick:v,className:"w-full",disabled:x,children:"I've Completed the Payment"})]})]})}),a==="verifying"&&e.jsxs("div",{className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mb-4"}),e.jsx("h3",{className:"font-medium text-lg mb-1",children:"Verifying Payment"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Please wait while we verify your payment..."})]}),a==="confirm"&&e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(z,{className:"h-8 w-8 text-green-500"})}),e.jsx("h3",{className:"font-medium text-lg mb-1",children:"Payment Successful"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Your task is being submitted"})]}),a==="failed"&&e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(xe,{className:"h-8 w-8 text-red-500"})}),e.jsx("h3",{className:"font-medium text-lg mb-1",children:"Payment Failed"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Your payment could not be processed"}),e.jsx("div",{className:"w-full space-y-2 mt-2",children:e.jsxs(b,{variant:"outline",onClick:j,className:"w-full",children:["Try Again",e.jsx(_t,{className:"ml-2 h-4 w-4"})]})})]})]})};var J="Radio",[Xt,Ae]=Q(J),[Zt,Jt]=Xt(J),Ie=n.forwardRef((t,r)=>{const{__scopeRadio:s,name:c,checked:a=!1,required:o,disabled:i,value:l="on",onCheck:m,form:p,...x}=t,[f,h]=n.useState(null),u=_(r,g=>h(g)),v=n.useRef(!1),j=f?p||!!f.closest("form"):!0;return e.jsxs(Zt,{scope:s,checked:a,disabled:i,children:[e.jsx(I.button,{type:"button",role:"radio","aria-checked":a,"data-state":Me(a),"data-disabled":i?"":void 0,disabled:i,value:l,...x,ref:u,onClick:P(t.onClick,g=>{a||m==null||m(),j&&(v.current=g.isPropagationStopped(),v.current||g.stopPropagation())})}),j&&e.jsx(Te,{control:f,bubbles:!v.current,name:c,value:l,checked:a,required:o,disabled:i,form:p,style:{transform:"translateX(-100%)"}})]})});Ie.displayName=J;var Ee="RadioIndicator",_e=n.forwardRef((t,r)=>{const{__scopeRadio:s,forceMount:c,...a}=t,o=Jt(Ee,s);return e.jsx(W,{present:c||o.checked,children:e.jsx(I.span,{"data-state":Me(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:r})})});_e.displayName=Ee;var es="RadioBubbleInput",Te=n.forwardRef(({__scopeRadio:t,control:r,checked:s,bubbles:c=!0,...a},o)=>{const i=n.useRef(null),l=_(i,o),m=bt(s),p=rt(r);return n.useEffect(()=>{const x=i.current;if(!x)return;const f=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(f,"checked").set;if(m!==s&&u){const v=new Event("click",{bubbles:c});u.call(x,s),x.dispatchEvent(v)}},[m,s,c]),e.jsx(I.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:l,style:{...a.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Te.displayName=es;function Me(t){return t?"checked":"unchecked"}var ts=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$="RadioGroup",[ss,ks]=Q($,[fe,Ae]),Oe=fe(),Fe=Ae(),[as,rs]=ss($),De=n.forwardRef((t,r)=>{const{__scopeRadioGroup:s,name:c,defaultValue:a,value:o,required:i=!1,disabled:l=!1,orientation:m,dir:p,loop:x=!0,onValueChange:f,...h}=t,u=Oe(s),v=Nt(p),[j,g]=ue({prop:o,defaultProp:a??null,onChange:f,caller:$});return e.jsx(as,{scope:s,name:c,required:i,disabled:l,value:j,onValueChange:g,children:e.jsx(gt,{asChild:!0,...u,orientation:m,dir:v,loop:x,children:e.jsx(I.div,{role:"radiogroup","aria-required":i,"aria-orientation":m,"data-disabled":l?"":void 0,dir:v,...h,ref:r})})})});De.displayName=$;var $e="RadioGroupItem",Ge=n.forwardRef((t,r)=>{const{__scopeRadioGroup:s,disabled:c,...a}=t,o=rs($e,s),i=o.disabled||c,l=Oe(s),m=Fe(s),p=n.useRef(null),x=_(r,p),f=o.value===a.value,h=n.useRef(!1);return n.useEffect(()=>{const u=j=>{ts.includes(j.key)&&(h.current=!0)},v=()=>h.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",v)}},[]),e.jsx(jt,{asChild:!0,...l,focusable:!i,active:f,children:e.jsx(Ie,{disabled:i,required:o.required,checked:f,...m,...a,name:o.name,ref:x,onCheck:()=>o.onValueChange(a.value),onKeyDown:P(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:P(a.onFocus,()=>{var u;h.current&&((u=p.current)==null||u.click())})})})});Ge.displayName=$e;var os="RadioGroupIndicator",qe=n.forwardRef((t,r)=>{const{__scopeRadioGroup:s,...c}=t,a=Fe(s);return e.jsx(_e,{...a,...c,ref:r})});qe.displayName=os;var Le=De,Ye=Ge,ns=qe;const Ue=n.forwardRef(({className:t,...r},s)=>e.jsx(Le,{className:X("grid gap-2",t),...r,ref:s}));Ue.displayName=Le.displayName;const E=n.forwardRef(({className:t,...r},s)=>e.jsx(Ye,{ref:s,className:X("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(ns,{className:"flex items-center justify-center",children:e.jsx(Pt,{className:"h-2.5 w-2.5 fill-current text-current"})})}));E.displayName=Ye.displayName;const is=({value:t,onChange:r})=>e.jsxs(Ue,{value:t,onValueChange:s=>r(s),className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 rounded-md border p-3 cursor-pointer hover:bg-accent",children:[e.jsx(E,{value:"email",id:"email"}),e.jsxs(F,{htmlFor:"email",className:"flex items-center cursor-pointer",children:[e.jsx(wt,{className:"h-4 w-4 mr-2"}),"Email"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rounded-md border p-3 cursor-pointer hover:bg-accent",children:[e.jsx(E,{value:"sms",id:"sms"}),e.jsxs(F,{htmlFor:"sms",className:"flex items-center cursor-pointer",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"SMS"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rounded-md border p-3 cursor-pointer hover:bg-accent",children:[e.jsx(E,{value:"slack",id:"slack"}),e.jsxs(F,{htmlFor:"slack",className:"flex items-center cursor-pointer",children:[e.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Slack"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rounded-md border p-3 cursor-pointer hover:bg-accent",children:[e.jsx(E,{value:"none",id:"none"}),e.jsxs(F,{htmlFor:"none",className:"flex items-center cursor-pointer",children:[e.jsx(St,{className:"h-4 w-4 mr-2"}),"None"]})]})]}),cs=ut({prompt:ae().min(10,{message:"Task description must be at least 10 characters."}),additionalInfo:ae().optional(),attachment:pt().optional()}),As=()=>{const{user:t}=ot(),{toast:r}=he(),s=nt(),c=it(),[a,o]=n.useState(null),[i,l]=n.useState(0),[m,p]=n.useState(!1),[x,f]=n.useState(!1),[h,u]=n.useState(!1),[v,j]=n.useState(""),[g,Ke]=n.useState("email"),[R,Be]=n.useState(null),[ee,te]=n.useState(!1),C=ct({resolver:mt(cs),defaultValues:{prompt:"",additionalInfo:""}});n.useEffect(()=>{var d;(d=c.state)!=null&&d.agent?(o(c.state.agent),M(c.state.agent,"")):(r({title:"No agent selected",description:"Please select an agent from the marketplace first.",variant:"destructive"}),s("/marketplace"))},[c.state,s,r]);const M=(d,N)=>{if(!d)return 0;let y=0;const Xe=N.trim().split(/\s+/).length;switch(d.pricing_model){case"free":y=0;break;case"pay-per-use":y=d.price||d.hourly_rate||.99;break;case"subscription":y=d.price||d.hourly_rate||9.99;break;case"custom":y=(d.price||d.hourly_rate||.5)*Math.max(1,Xe/100);break;default:y=d.price||d.hourly_rate||.99}h&&(y+=.5),y=Math.round(y*100)/100,l(y)},Ve=d=>{var y;const N=(y=d.target.files)==null?void 0:y[0];N&&(u(!0),j(N.name),a&&M(a,C.getValues().prompt))},O=C.watch("prompt");n.useEffect(()=>{a&&M(a,O)},[O,a]);const He=async d=>{if(!a){r({title:"No agent selected",description:"Please select an agent to process your task.",variant:"destructive"});return}if(!t){r({title:"Authentication required",description:"Please sign in to submit tasks.",variant:"destructive"}),s("/sign-in",{state:{returnUrl:"/task-submission",agent:a}});return}f(!0),te(!1);try{const N={userId:t.id,agentId:a.id,prompt:d.prompt,additionalInfo:d.additionalInfo||null,attachmentUrl:null,price:i,notificationChannel:g,outputFormat:"text",maxRevisions:a.max_revisions||3},y=await le.createTask(N);if(!y)throw new Error("Task creation failed. Please check logs or try again.");Be(y.id),p(!0)}catch(N){console.error("Error submitting task:",N),r({title:"Error submitting task",description:"There was a problem submitting your task. Please try again.",variant:"destructive"})}finally{f(!1)}},ze=async()=>{if(!(!t||!a||!R))try{if(!await S.updateTaskPaymentStatus(R,"completed"))throw new Error("Failed to update payment status");await le.startTaskProcessing(R),r({title:"Task submitted successfully",description:"Your task has been submitted and will be processed shortly."}),s("/dashboard",{state:{newTaskId:R}})}catch(d){console.error("Error handling payment success:",d),r({title:"Error updating task",description:"Payment processed but we couldn't update your task status. Please contact support.",variant:"destructive"})}},Qe=async()=>{if(R)try{await S.updateTaskPaymentStatus(R,"failed"),te(!0),r({title:"Payment failed",description:"Your payment could not be processed. Please try again or use a different payment method.",variant:"destructive"})}catch(d){console.error("Error handling payment failure:",d)}};if(!a)return e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(re,{}),e.jsx("main",{className:"flex-grow pt-24 pb-16 page-transition",children:e.jsx("div",{className:"container mx-auto px-4 text-center",children:e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading..."})})}),e.jsx(oe,{})]});const We=a.image||"https://via.placeholder.com/150",se=a.price||a.hourly_rate||0;return e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(re,{}),e.jsx("main",{className:"flex-grow pt-24 pb-16 page-transition",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-6 max-w-5xl",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-6",children:"Submit Your Task"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(K,{children:[e.jsxs(B,{children:[e.jsx(V,{children:"Task Details"}),e.jsxs(ie,{children:["Provide details about what you'd like ",a.name," to do"]})]}),e.jsx(H,{children:e.jsx(lt,{...C,children:e.jsxs("form",{onSubmit:C.handleSubmit(He),className:"space-y-6",children:[e.jsx(G,{control:C.control,name:"prompt",render:({field:d})=>e.jsxs(q,{children:[e.jsx(L,{children:"Task Description"}),e.jsx(Y,{children:e.jsx(ne,{placeholder:"Describe your task in detail...",className:"min-h-[120px]",...d})}),e.jsx(dt,{children:"Be specific about what you want the AI agent to accomplish."}),e.jsx(U,{})]})}),e.jsx(G,{control:C.control,name:"additionalInfo",render:({field:d})=>e.jsxs(q,{children:[e.jsx(L,{children:"Additional Information (Optional)"}),e.jsx(Y,{children:e.jsx(ne,{placeholder:"Any context or specific requirements...",className:"min-h-[80px]",...d})}),e.jsx(U,{})]})}),e.jsx(G,{control:C.control,name:"attachment",render:({field:{value:d,onChange:N,...y}})=>e.jsxs(q,{children:[e.jsx(L,{children:"Attachments (Optional)"}),e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 border-gray-300",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Tt,{className:"w-8 h-8 mb-2 text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, JPG, PNG (MAX. 10MB)"})]}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:Ve,...y})]})}),h&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md border border-gray-200",children:[e.jsx("span",{className:"text-sm truncate max-w-[250px]",children:v}),e.jsxs(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>{u(!1),j(""),M(a,O)},className:"h-6 w-6 p-0",children:[e.jsx("span",{className:"sr-only",children:"Remove"}),e.jsx(xe,{className:"h-4 w-4"})]})]})]})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"space-y-4 border rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(At,{className:"h-5 w-5 mr-2 text-muted-foreground"}),e.jsx("h3",{className:"font-medium",children:"Notification Preferences"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose how you'd like to be notified about task status updates:"}),e.jsx(is,{value:g,onChange:Ke})]}),!m&&!ee&&e.jsx(b,{type:"submit",className:"w-full",disabled:x,children:x?"Processing...":"Continue to Payment"}),ee&&e.jsx(b,{type:"submit",className:"w-full",disabled:x,children:"Try Payment Again"})]})})})]})}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs(K,{children:[e.jsx(B,{children:e.jsx(V,{children:"Task Summary"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Selected Agent"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cover bg-center",style:{backgroundImage:`url(${We})`}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.category})]})]})]}),e.jsx(ce,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Pricing Details"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Base price"}),e.jsxs("span",{className:"text-sm",children:["$",se.toFixed(2)]})]}),h&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"File processing"}),e.jsx("span",{className:"text-sm",children:"$0.50"})]}),a.pricing_model==="custom"&&O.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Task complexity"}),e.jsxs("span",{className:"text-sm",children:["$",(i-se-(h?.5:0)).toFixed(2)]})]})]})]}),e.jsx(ce,{}),e.jsxs("div",{className:"flex items-center justify-between font-medium",children:[e.jsx("span",{children:"Total Estimated Price"}),e.jsxs("span",{className:"text-lg",children:["$",i.toFixed(2)]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md text-sm",children:e.jsxs("p",{className:"flex items-center text-gray-500",children:[e.jsx(It,{className:"h-4 w-4 mr-1"}),a.pricing_model==="free"?"This agent is free to use":a.pricing_model==="subscription"?"Monthly subscription":"Pay only for what you use"]})})]})]}),e.jsxs(K,{className:"mt-6",children:[e.jsxs(B,{children:[e.jsx(V,{children:"Payment"}),e.jsx(ie,{children:"Complete your payment to submit the task"})]}),e.jsx(H,{children:e.jsx(Wt,{amount:i,onSuccess:ze,onFailed:Qe})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Ht,{children:[e.jsx(zt,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full",children:[e.jsx(kt,{className:"mr-2 h-4 w-4"}),"Task Submission Help"]})}),e.jsx(ke,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Tips for effective tasks:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:[e.jsx("li",{children:"Be specific about what you want the agent to do"}),e.jsx("li",{children:"Provide clear examples or references if needed"}),e.jsx("li",{children:"Set clear expectations for the output format"}),e.jsx("li",{children:"Upload relevant documents if they help explain your needs"})]})]})})]})})]})]})]})}),e.jsx(oe,{})]})};export{As as default};
